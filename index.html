<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>coco medaka 35</title>

<title>メダカ予約注文</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>

    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      z-index: 9999;
    }

    #main-content {
      display: none;
    }



  /* 大きなチェックボックスのスタイル */
  input[type="checkbox"] {
    transform: scale(1.5); /* サイズを1.5倍にする */
    margin-right: 1.5vw; /* チェックボックスとラベルの間にスペースを追加 */
  }

  label {
    font-size: 5vw; /* チェックボックスラベルのフォントサイズを調整 */
  }


/* 大きなボタンのスタイル */
  #submit-button {
    padding: 1vw 5vw; /* ボタンの内側の余白を調整 */
    font-size: 8vw; /* ボタンのフォントサイズを調整 */
     border: 2px solid #4CAF50; /* 枠線の太さと色を設定 */
    background-color: #eee; /* ボタンの背景色 */
    color: black; /* ボタンの文字色 */
    border-radius: 5px; /* ボタンの角を丸くする */
    cursor: pointer; /* ポインタカーソルを表示 */
border-color: black; /* ホバー時の枠線の色 */
  }

  #submit-button:disabled {
    background-color: #eee; /* 無効化時の背景色 */
    cursor: not-allowed; /* 無効化時のカーソル */
   color: #ccc; /* ボタンの文字色 */
border-color: #ccc; /* ホバー時の枠線の色 */

  }
  
  </style>


<link rel="stylesheet" href="css/style.css">



</head>
<body>
  <div id="loading">Loading...</div>
  <div id="main-content">
    <h1 class = "top">メダカ予約注文</h1>
    <form id="order-form">
       <h1><label for="species">品種名:</label>
      <select id="species" name="species" required onchange="updatePrice()">
        <!-- Options will be populated dynamically -->
      </select><br>
      <label for="quantity">匹数:</label>
      <select id="quantity" name="quantity" required onchange="updatePrice()">
        <option value="1">1匹</option>
        <option value="2">2匹</option>
        <option value="3">3匹</option>
        <option value="4">4匹</option>
        <option value="5">5匹</option>
      </select><br><br></h1>

      <h1>↓　受取希望日を選択　↓</h1>
      <h1><div><input type="date" name="daytime" class="button" id="tomorrow" style="font-size:8vw" required></div></h1>
      <h1></h1>

      <h1><p>合計金額: <span id="total-price">0</span>円</p></h1><br>
      <label for="agreement">
        <input type="checkbox" id="agreement" name="agreement" onchange="toggleSubmitButton()">
        <h1>期日までに受け取り来られなかった場合、CoCoポイントが10pt消失することに同意する<h1>
      </label><br>
      <h1 class ="top"><button type="button" id="submit-button" onclick="submitOrder()" disabled>確定</button></h1>
    </form>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const d = new Date();
      d.setDate(d.getDate() + 2);
      document.getElementById("tomorrow").setAttribute("min", d.toISOString().substr(0, 10));

      const d1 = new Date();
      d1.setDate(d1.getDate() + 2 + 28);
      document.getElementById("tomorrow").setAttribute("max", d1.toISOString().substr(0, 10));

      // Set the default date to today
      const today = new Date();
      today.setDate(today.getDate());
      const yyyy = today.getFullYear();
      const mm = ("0" + (today.getMonth() + 1)).slice(-2);
      const dd = ("0" + today.getDate()).slice(-2);
      document.getElementById("tomorrow").value = yyyy + '-' + mm + '-' + dd;

      // Fetch medaka data and populate the form
      fetchMedakaData();
    });

    async function fetchMedakaData() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbxr0faBQov90nKkneEt-OLXwmdV1pOoUBeHHD2Vjy7nvjpTpEn5oow415dvOI8Q3yRU/exec');
        const data = await response.json();
        
        const select = document.getElementById('species');
        select.innerHTML = '<option value="">  -- 品種を選択 --</option>'; // Default option
        
        data.forEach(row => {
          const species = row[0];
          const price = parseInt(row[1], 10);
          const option = document.createElement('option');
          option.value = species;
          option.textContent = species;
          select.appendChild(option);
          // Store prices in a global object
          prices[species] = price;
        });

        // Hide loading screen and show main content
        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    let prices = {};

    function calculatePrice(species, quantity) {
      return prices[species] * quantity;
    }

    function updatePrice() {
      const species = document.getElementById('species').value;
      const quantity = document.getElementById('quantity').value;
      const totalPrice = calculatePrice(species, quantity);
      document.getElementById('total-price').textContent = totalPrice;
    }

    function toggleSubmitButton() {
      const agreementChecked = document.getElementById('agreement').checked;
      const submitButton = document.getElementById('submit-button');
      submitButton.disabled = !agreementChecked;
    }

    async function submitOrder() {
      const species = document.getElementById('species').value;
      const quantity = document.getElementById('quantity').value;
      const date = document.getElementById('tomorrow').value;
      const price = calculatePrice(species, quantity);

      const message = `【注文内容】\n==============================\n品種名: ${species}\n数量(匹): ${quantity}\n==============================\n代金: ${price}円\n==============================\n受け取り希望日: ${date}`;

      try {
        await liff.sendMessages([{
          type: 'text',
          text: message
        }]);
        
        // Close the LIFF window
        liff.closeWindow();
	      
      } catch (error) {
        console.error('Error sending message:', error);
      }
    }

    async function main() {
      await liff.init({ liffId: "1657196041-ALeOLrEa" });
      if (!liff.isLoggedIn()) {
        liff.login();
      }
    }

    main();
  </script>
</body>
	
	
	
	
</html>
