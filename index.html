
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>coco medaka 35</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5vw;
      z-index: 9999;
    }
    #main-content {
      display: none;
    }
    input[type="checkbox"] {
      width: 3vw; 
      height: 3vw; 
      margin-right: 1vw; 
      margin-left: 1vw; 
    }
    label {
      font-size: 4vw; 
    }
    #submit-button {
      padding: 1vw 5vw; 
      font-size: 8vw; 
      border: 2px solid #4CAF50; 
      background-color: #eee; 
      color: black; 
      border-radius: 5px; 
      cursor: pointer; 
      border-color: black; 
    }
    #submit-button:disabled {
      background-color: #eee; 
      cursor: not-allowed; 
      color: #ccc; 
      border-color: #ccc; 
    }
    .image-preview {
      max-width: 100%;
      height: auto;
      display: block;
      margin-top: 1vw;
    }
  </style>
</head>
<body>
  <div id="loading">Loading...</div>
  <div id="main-content">
    <h1 class="top">メダカ予約注文</h1>
    <h1>※ご希望の品種と数量、受取日を指定したうえで確定ボタンを押してください。</h1>
    <br>
    <form id="order-form">
      <h1>
        <label for="species">品種名:</label>
        <select id="species" name="species" required onchange="updatePriceAndImage()">
          <!-- Options will be populated dynamically -->
        </select>
        <br>
        <label for="quantity">匹数:</label>
        <select id="quantity" name="quantity" required onchange="updatePriceAndImage()">
          <option value="">選択してください</option>
          <option value="1">1匹</option>
          <option value="2">2匹</option>
          <option value="3">3匹</option>
          <option value="4">4匹</option>
          <option value="5">5匹</option>
        </select>
        <br><br>
      </h1>
      <h1>↓　受取希望日を選択　↓</h1>
      <h1>
        <div><input type="date" name="daytime" class="button" id="tomorrow" style="font-size:8vw" required onchange="toggleSubmitButton()"></div>
      </h1>
      <h1></h1>
      <h1>
        <p>合計金額: <span id="total-price">0</span>円</p>
      </h1>
      <br>
      <h1 class="cp">
        <label for="agreement">
          <input type="checkbox" id="agreement" name="agreement" onchange="toggleSubmitButton()">
          期日までに受け取り来られなかった場合、CoCoポイントが10pt消失することに同意する
        </label>
      </h1>
      <br>
      <h1 class="top">
        <button type="button" id="submit-button" onclick="submitOrder()" disabled>確定</button>
      </h1>
    </form>
    <img id="species-image" class="image-preview" src="" alt="選択したメダカの画像が表示されます">
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const d = new Date();
      d.setDate(d.getDate() + 2);
      document.getElementById("tomorrow").setAttribute("min", d.toISOString().substr(0, 10));
      const d1 = new Date();
      d1.setDate(d1.getDate() + 2 + 28);
      document.getElementById("tomorrow").setAttribute("max", d1.toISOString().substr(0, 10));
      fetchMedakaData();
    });

    async function fetchMedakaData() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwaZE7oDLJryplPnZE3RjRdcOQvo5GlQZaRTfh4D7NgxMdhbsGb06FpxMmNo1gCBfiW/exec');
        const data = await response.json();
        
        const select = document.getElementById('species');
        select.innerHTML = '<option value="">  -- 品種を選択 --</option>'; // Default option
        
        data.forEach(row => {
          const species = row[0];
          const price = parseInt(row[1], 10);
          const imageUrl = row[2];
          const option = document.createElement('option');
          option.value = species;
          option.textContent = species;
          select.appendChild(option);
          prices[species] = { price, imageUrl };
        });

        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    let prices = {};

    function calculatePrice(species, quantity) {
      return prices[species] ? prices[species].price * quantity : 0;
    }

    function updatePriceAndImage() {
      const species = document.getElementById('species').value;
      const quantity = document.getElementById('quantity').value;
      const totalPrice = calculatePrice(species, quantity);
      document.getElementById('total-price').textContent = totalPrice;

      const speciesImage = document.getElementById('species-image');
      if (species && prices[species]) {
        speciesImage.src = prices[species].imageUrl;
        speciesImage.alt = `${species}の画像`;
        speciesImage.style.display = 'block';
      } else {
        speciesImage.src = '';
        speciesImage.alt = '選択したメダカの画像が表示されます';
        speciesImage.style.display = 'none';
      }
      toggleSubmitButton();
    }

    function toggleSubmitButton() {
      const species = document.getElementById('species').value;
      const quantity = document.getElementById('quantity').value;
      const date = document.getElementById('tomorrow').value;
      const agreementChecked = document.getElementById('agreement').checked;
      const submitButton = document.getElementById('submit-button');

      submitButton.disabled = !(species && quantity && date && agreementChecked);
    }

    async function submitOrder() {
      const species = document.getElementById('species').value;
      const quantity = document.getElementById('quantity').value;
      const date = document.getElementById('tomorrow').value;
      const price = calculatePrice(species, quantity);

      const message = `【注文内容】\n==============================\n品種名: ${species}\n数量(匹): ${quantity}\n代金: ${price}円\n==============================\n受け取り希望日: ${date}`;

      try {
        await liff.sendMessages([{
          type: 'text',
          text: message
        }]);
        liff.closeWindow();
      } catch (error) {
        console.error('Error sending message:', error);
      }
    }

    async function main() {
      await liff.init({ liffId: "1657196041-ALeOLrEa" });
      if (!liff.isLoggedIn()) {
        liff.login();
      }
    }

    main();
  </script>
</body>
</html>






